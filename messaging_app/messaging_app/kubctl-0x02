#!/bin/bash
# kubctl-0x02

# Apply blue deployment (existing version)
echo "Applying blue deployment..."
kubectl apply -f blue_deployment.yaml

# Apply green deployment (new version)
echo "Applying green deployment..."
kubectl apply -f green_deployment.yaml

# Apply the Service to route traffic
echo "Applying service..."
kubectl apply -f kubeservice.yaml

# Wait a few seconds for pods to be created
echo "Waiting for pods to be ready..."
sleep 10

# Get all pods and show status
echo "Listing all pods:"
kubectl get pods -A

# Check logs of green deployment pods for errors
echo "Checking logs of green deployment pods..."
GREEN_PODS=$(kubectl get pods -l app=django,version=green -o jsonpath='{.items[*].metadata.name}')

for pod in $GREEN_PODS; do
    echo "Logs for pod $pod:"
    kubectl logs $pod
done
